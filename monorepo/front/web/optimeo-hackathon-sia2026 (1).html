<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimeo â€” Simulateur IFT Â· Hackathon SIA 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/*
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  OPTIMEO â€” Charte inspirÃ©e Bloomeo
  Couleurs extraites de la capture :
    Topbar : #CBE99B (vert lime trÃ¨s pÃ¢le)
    Sidebar bg : #FFFFFF, border : #E6EFE2
    Item actif : text #2E7D4F, bg #EBF5E1
    Card bg : #F3F9EC, border : #DDF0C8
    Accent vert : #4DA86B
    Accent teal : #3ABABA
    Accent violet : #9966CC
    Accent orange : #E8923A
    Text principal : #1B2E1B
    Text secondaire : #5E7A5E
    Text tertiary : #90A890
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --sb-w: 218px;
  --top-h: 46px;
  --bg: #F6FAF3;
  --white: #FFFFFF;
  --border: #E4EDD F;
  --border: #E4EDDF;
  --border2: #CFDEC8;
  --green: #4DA86B;
  --green-d: #2E7D4F;
  --green-l: #EBF5E1;
  --green-ll: #F3F9EC;
  --green-mid: #CBE99B;
  --teal: #3ABABA;
  --teal-l: #E5F6F6;
  --violet: #9966CC;
  --violet-l: #F2ECFA;
  --orange: #E8923A;
  --orange-l: #FDF2E8;
  --red: #D94F4F;
  --red-l: #FDEBEB;
  --blue: #3A82C8;
  --blue-l: #EBF3FC;
  --text: #1B2E1B;
  --text2: #4E6A4E;
  --text3: #8EA48E;
  --topbar: #CBE99B;
}
html { font-size: 13px; }
body {
  font-family: 'Plus Jakarta Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  display: flex;
  overflow: hidden;
}

/* â•â• SIDEBAR â•â• */
.sidebar {
  width: var(--sb-w);
  background: var(--white);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  height: 100vh;
  overflow-y: auto;
}
.sb-logo {
  padding: 13px 14px 11px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 9px;
}
.sb-logo-badge {
  width: 30px; height: 30px;
  background: linear-gradient(135deg, var(--green), var(--green-d));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: .75rem; font-weight: 800; color: white; letter-spacing: -.02em;
  flex-shrink: 0;
  box-shadow: 0 2px 6px rgba(77,168,107,.3);
}
.sb-logo-name {
  font-size: 1.05rem; font-weight: 800;
  color: var(--text); letter-spacing: -.02em;
}
.sb-logo-name span { color: var(--green); }
.sb-logo-tag {
  font-size: .5rem; font-weight: 600; letter-spacing: .1em;
  text-transform: uppercase; color: var(--text3);
  background: var(--green-l); padding: 2px 5px; border-radius: 3px;
  margin-left: auto; flex-shrink: 0;
}

.sb-section { padding: 10px 10px 4px; }
.sb-cat {
  font-size: .58rem; font-weight: 700; letter-spacing: .13em;
  text-transform: uppercase; color: var(--text3);
  padding: 0 5px; margin-bottom: 3px;
}
.sb-item {
  display: flex; align-items: center; gap: 7px;
  padding: 7px 9px; border-radius: 7px;
  font-size: .8rem; font-weight: 500;
  color: var(--text2); cursor: pointer;
  transition: all .14s; margin-bottom: 1px;
}
.sb-item:hover { background: var(--green-l); color: var(--green-d); }
.sb-item.active {
  background: var(--green-l); color: var(--green-d); font-weight: 700;
  box-shadow: inset 2px 0 0 var(--green);
}
.sb-item .ico { font-size: .9rem; width: 17px; text-align: center; flex-shrink: 0; }
.sb-item .badge-count {
  margin-left: auto; font-size: .6rem; font-weight: 700;
  background: var(--green); color: white;
  padding: 1px 5px; border-radius: 10px; line-height: 1.4;
}
.sb-bloc {
  margin: 10px 10px 0;
  background: var(--green-ll); border: 1px solid var(--border);
  border-radius: 8px; padding: 9px 10px;
}
.sb-bloc-label { font-size: .6rem; font-weight: 700; color: var(--text3); margin-bottom: 4px; text-transform: uppercase; letter-spacing: .1em; }
.sb-bloc-name { font-size: .78rem; font-weight: 700; color: var(--text); }
.sb-bloc-sub { font-size: .65rem; color: var(--text2); margin-top: 1px; }
.sb-bloc-tag { display: inline-block; margin-top: 5px; font-size: .6rem; font-weight: 700; padding: 2px 7px; border-radius: 20px; }
.sb-bloc-tag.warn { background: var(--orange-l); color: var(--orange); border: 1px solid #F4C899; }
.sb-bloc-tag.ok { background: var(--green-l); color: var(--green-d); border: 1px solid #B8DDA0; }

/* â•â• RIGHT â•â• */
.right { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

/* â•â• TOPBAR â•â• */
.topbar {
  background: var(--topbar);
  height: var(--top-h);
  flex-shrink: 0;
  display: flex; align-items: center;
  padding: 0 18px;
  border-bottom: 1px solid #B4D47A;
  gap: 0;
}
.topbar-title { font-size: .92rem; font-weight: 700; color: var(--text); flex: 1; }
.topbar-chips { display: flex; gap: 6px; align-items: center; }
.topbar-chip {
  display: flex; align-items: center; gap: 5px;
  background: rgba(255,255,255,.65);
  border: 1px solid rgba(255,255,255,.9);
  border-radius: 20px; padding: 4px 10px;
  font-size: .7rem; font-weight: 500; color: var(--text);
  backdrop-filter: blur(4px);
}
.chip-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.topbar-avatar {
  width: 26px; height: 26px;
  background: var(--green-d); color: white; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: .6rem; font-weight: 800; margin-left: 8px;
}

/* â•â• CONTENT â•â• */
.content { flex: 1; overflow-y: auto; padding: 18px 20px; }
.page { display: none; }
.page.active { display: block; }

/* â•â• PAGE HEADER â•â• */
.page-hd {
  display: flex; align-items: flex-start; justify-content: space-between;
  margin-bottom: 16px;
}
.page-hd h1 { font-size: 1.1rem; font-weight: 800; color: var(--text); letter-spacing: -.02em; }
.page-hd p { font-size: .72rem; color: var(--text2); margin-top: 2px; font-weight: 400; }
.page-hd-right { display: flex; gap: 7px; align-items: center; flex-shrink: 0; }

/* â•â• BUTTONS â•â• */
.btn {
  padding: 6px 14px; border-radius: 7px; border: 1px solid;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .73rem; font-weight: 700; cursor: pointer; transition: all .14s;
  display: inline-flex; align-items: center; gap: 5px;
}
.btn-green { background: var(--green); border-color: var(--green-d); color: white; }
.btn-green:hover { background: var(--green-d); }
.btn-teal { background: var(--teal); border-color: #2A9A9A; color: white; }
.btn-outline { background: white; border-color: var(--border2); color: var(--text2); }
.btn-outline:hover { border-color: var(--green); color: var(--green-d); }

/* â•â• FILTERS â•â• */
.filters {
  background: var(--white); border: 1px solid var(--border);
  border-radius: 10px; padding: 12px 14px;
  display: flex; gap: 10px; align-items: flex-end;
  flex-wrap: wrap; margin-bottom: 14px;
}
.fg { display: flex; flex-direction: column; gap: 3px; }
.fg-label {
  font-size: .6rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: .1em; color: var(--text3);
}
.fg-sel, .fg-inp {
  border: 1px solid var(--border2); border-radius: 7px;
  padding: 6px 10px; font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .77rem; color: var(--text); background: var(--white);
  outline: none; min-width: 128px; appearance: none;
  transition: border-color .14s;
}
.fg-sel:focus, .fg-inp:focus { border-color: var(--green); box-shadow: 0 0 0 2px rgba(77,168,107,.1); }
.fg-sep { width: 1px; background: var(--border); align-self: stretch; margin: 0 4px; }
.fg-highlight {
  background: var(--green-ll); border: 1px solid var(--border);
  border-radius: 7px; padding: 6px 10px;
  font-size: .77rem; color: var(--text);
  display: flex; align-items: center; gap: 6px;
}

/* â•â• KPI ROW â•â• */
.kpi-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px; }
.kpi {
  background: var(--white); border: 1px solid var(--border);
  border-radius: 10px; padding: 13px 14px;
}
.kpi.green { background: var(--green-ll); border-color: #CBEAA8; }
.kpi.teal  { background: var(--teal-l);   border-color: #B5E4E4; }
.kpi.violet{ background: var(--violet-l); border-color: #D4C0F0; }
.kpi-label { font-size: .67rem; font-weight: 600; color: var(--text2); display: flex; align-items: center; gap: 5px; margin-bottom: 4px; }
.kpi-val   { font-size: 1.55rem; font-weight: 800; line-height: 1; letter-spacing: -.03em; }
.kpi-val.green  { color: var(--green-d); }
.kpi-val.teal   { color: #1F9595; }
.kpi-val.violet { color: var(--violet); }
.kpi-sub   { font-size: .62rem; color: var(--text3); margin-top: 3px; }
.kpi-delta { display: inline-flex; align-items: center; gap: 3px; margin-top: 6px; font-size: .68rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; }
.kpi-delta.warn { background: var(--orange-l); color: var(--orange); }
.kpi-delta.good { background: var(--green-l); color: var(--green-d); }
.kpi-delta.bad  { background: var(--red-l); color: var(--red); }

/* â•â• LAYOUT HELPERS â•â• */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; }
.g3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 14px; }
.g64 { display: grid; grid-template-columns: 1.72fr 1fr; gap: 12px; }

/* â•â• CARD â•â• */
.card {
  background: var(--white); border: 1px solid var(--border);
  border-radius: 10px; padding: 14px;
}
.card.green-bg { background: var(--green-ll); border-color: #CBEAA8; }
.card-h {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 12px;
}
.card-title {
  font-size: .8rem; font-weight: 700; color: var(--text);
  display: flex; align-items: center; gap: 6px;
}

/* â•â• BADGE â•â• */
.badge {
  display: inline-flex; align-items: center; gap: 3px;
  padding: 2px 8px; border-radius: 20px;
  font-size: .63rem; font-weight: 700;
}
.badge::before { content: 'â—'; font-size: .4rem; }
.bg-green  { background: var(--green-l); color: var(--green-d); }
.bg-teal   { background: var(--teal-l); color: #1F9595; }
.bg-violet { background: var(--violet-l); color: var(--violet); }
.bg-orange { background: var(--orange-l); color: var(--orange); }
.bg-gray   { background: #F0F0F0; color: #666; }
.bg-red    { background: var(--red-l); color: var(--red); }

/* â•â• LEVERS GRID â•â• */
.lev-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; }
.lt {
  background: var(--green-ll); border: 1px solid #CBEAA8;
  border-radius: 8px; padding: 11px 12px;
}
.lt-h { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
.lt-name { font-size: .77rem; font-weight: 700; color: var(--text); }
.lt-var { font-size: .58rem; color: var(--text3); margin-top: 1px; font-style: italic; }
.badge-type { font-size: .55rem; font-weight: 700; padding: 2px 6px; border-radius: 20px; text-transform: uppercase; letter-spacing: .04em; flex-shrink: 0; margin-left: 5px; }
.bt-q  { background: var(--blue-l); color: var(--blue); }
.bt-ql { background: var(--violet-l); color: var(--violet); }
/* freq bars */
.fr { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
.fr-lbl { font-size: .65rem; color: var(--text2); width: 105px; flex-shrink: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.fr-trk { flex: 1; height: 5px; background: #DCF0CC; border-radius: 3px; overflow: hidden; }
.fr-fil { height: 100%; border-radius: 3px; background: var(--green); transition: width .7s; }
.fr-fil.top { background: var(--green-d); }
.fr-pct { font-size: .62rem; color: var(--text3); width: 26px; text-align: right; font-weight: 700; flex-shrink: 0; }
/* quant */
.qv { font-size: 1.22rem; font-weight: 800; color: var(--green-d); line-height: 1; letter-spacing: -.02em; }
.qu { font-size: .6rem; color: var(--text3); margin-top: 1px; }
.qvs { font-size: .62rem; color: var(--text2); margin: 4px 0 3px; }
.qbar-row { display: flex; align-items: center; gap: 5px; margin-bottom: 2px; }
.qbar-lbl { font-size: .58rem; width: 52px; flex-shrink: 0; }
.qbar-trk { flex: 1; height: 4px; background: #DCF0CC; border-radius: 2px; overflow: hidden; }
.qbar-fil { height: 100%; border-radius: 2px; }

/* â•â• TABLE â•â• */
.tbl { width: 100%; border-collapse: collapse; }
.tbl th { font-size: .67rem; font-weight: 700; color: var(--text2); padding: 7px 9px; border-bottom: 1px solid var(--border); text-align: left; white-space: nowrap; }
.tbl td { font-size: .73rem; padding: 7px 9px; border-bottom: 1px solid #F2F7EE; vertical-align: middle; }
.tbl tr:hover td { background: #FAFDF7; }
.tbl tr:last-child td { border-bottom: none; }
.tbl-rank { font-size: .67rem; font-weight: 700; color: var(--text3); }
.tbl-name { font-size: .74rem; font-weight: 700; }
.tbl-sub  { font-size: .59rem; color: var(--text3); margin-top: 1px; }

/* â•â• STEPS â•â• */
.steps { display: flex; align-items: center; gap: 0; background: var(--white); border: 1px solid var(--border); border-radius: 8px; padding: 4px; }
.step { display: flex; align-items: center; gap: 5px; padding: 5px 11px; border-radius: 5px; font-size: .72rem; font-weight: 600; color: var(--text3); cursor: pointer; transition: all .15s; }
.step.active { background: var(--green); color: white; font-weight: 700; }
.step.done { color: var(--green-d); font-weight: 700; }
.step-n { width: 17px; height: 17px; border-radius: 50%; background: var(--border); display: flex; align-items: center; justify-content: center; font-size: .6rem; font-weight: 800; flex-shrink: 0; }
.step.active .step-n { background: rgba(255,255,255,.3); color: white; }
.step.done .step-n { background: var(--green-d); color: white; }
.step-sep { color: var(--border2); font-size: .75rem; padding: 0 2px; }

/* â•â• ITK LAYOUT â•â• */
.itk-layout { display: grid; grid-template-columns: 1fr 275px; gap: 14px; }
.fsec { margin-bottom: 14px; }
.fsec-title {
  font-size: .68rem; font-weight: 800; text-transform: uppercase; letter-spacing: .1em;
  color: var(--text2); border-bottom: 2px solid var(--green-l); padding-bottom: 6px;
  margin-bottom: 10px; display: flex; align-items: center; gap: 6px;
}
.fgrid { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; }
.fgrid.t3 { grid-template-columns: 1fr 1fr 1fr; }
.fld { display: flex; flex-direction: column; gap: 3px; }
.fld.full { grid-column: span 2; }
.flbl {
  font-size: .67rem; font-weight: 600; color: var(--text2);
  display: flex; align-items: center; gap: 5px; flex-wrap: wrap;
}
.fref {
  font-size: .57rem; background: var(--green-l); color: var(--green-d);
  padding: 1px 5px; border-radius: 3px; font-weight: 700;
}
.fsel, .finp {
  border: 1px solid var(--border2); border-radius: 7px; padding: 7px 9px;
  font-family: 'Plus Jakarta Sans', sans-serif; font-size: .76rem;
  color: var(--text); background: var(--white); outline: none;
  appearance: none; -webkit-appearance: none;
  transition: border-color .14s, box-shadow .14s;
}
.fsel:focus, .finp:focus { border-color: var(--green); box-shadow: 0 0 0 2px rgba(77,168,107,.1); }
.chips { display: flex; gap: 5px; flex-wrap: wrap; }
.chip {
  padding: 5px 10px; border-radius: 6px; border: 1px solid var(--border2);
  font-size: .71rem; font-weight: 600; cursor: pointer;
  background: var(--white); color: var(--text2); transition: all .13s;
}
.chip:hover { border-color: var(--green); color: var(--green-d); }
.chip.on { background: var(--green); border-color: var(--green-d); color: white; }
.slider-w { display: flex; flex-direction: column; gap: 2px; }
.slider-top { display: flex; justify-content: space-between; align-items: baseline; }
.slider-top .cap { font-size: .6rem; color: var(--text3); }
.slider-val { font-size: .78rem; font-weight: 800; color: var(--green-d); }
.fslider {
  width: 100%; height: 5px; border-radius: 3px; background: var(--border2);
  outline: none; cursor: pointer; -webkit-appearance: none; appearance: none;
}
.fslider::-webkit-slider-thumb {
  -webkit-appearance: none; width: 15px; height: 15px; border-radius: 50%;
  background: var(--green); cursor: pointer; border: 2px solid white;
  box-shadow: 0 1px 4px rgba(0,0,0,.18);
}

/* â•â• IFT RESULT SIDEBAR â•â• */
.ift-card {
  background: var(--green-ll); border: 1px solid #C0E8A0;
  border-radius: 10px; padding: 14px; text-align: center; margin-bottom: 11px;
  position: relative; overflow: hidden;
}
.ift-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--green), var(--teal));
}
.ift-card-lbl { font-size: .62rem; font-weight: 700; color: var(--text2); text-transform: uppercase; letter-spacing: .1em; margin-bottom: 5px; }
.ift-card-val { font-size: 3rem; font-weight: 800; line-height: 1; letter-spacing: -.04em; transition: color .4s; }
.ift-card-unit { font-size: .88rem; font-weight: 500; color: var(--text2); margin-left: 2px; }
.ift-card-sub { font-size: .62rem; color: var(--text2); margin-top: 4px; }
.gauge-wrap { margin: 9px 0 3px; }
.gauge-trk { height: 8px; background: #D0EAB8; border-radius: 4px; overflow: hidden; position: relative; }
.gauge-fil { height: 100%; border-radius: 4px; transition: width .5s ease, background .4s; }
.gauge-tks { display: flex; justify-content: space-between; margin-top: 3px; }
.gauge-tks span { font-size: .56rem; color: var(--text3); }
.cr { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-top: 1px solid var(--border); font-size: .71rem; }
.cr .k { color: var(--text2); }
.cr .v { font-weight: 800; font-size: .73rem; }
.v-good  { color: var(--green-d); }
.v-warn  { color: var(--orange); }
.v-bad   { color: var(--red); }
.v-neu   { color: var(--text3); }
.v-teal  { color: var(--teal); }

/* â•â• SIM LAYOUT â•â• */
.sim-layout { display: grid; grid-template-columns: 1fr 340px; gap: 14px; }

/* summary header */
.sim-summary {
  background: var(--white); border: 1px solid var(--border); border-radius: 10px;
  padding: 12px 16px; margin-bottom: 14px;
  display: flex; align-items: center; justify-content: space-between; gap: 16px;
}
.ss-group { text-align: center; }
.ss-lbl { font-size: .62rem; font-weight: 600; color: var(--text2); margin-bottom: 3px; }
.ss-val { font-size: 1.45rem; font-weight: 800; letter-spacing: -.03em; line-height: 1; }
.ss-val.current { color: var(--orange); }
.ss-val.simulated { color: var(--teal); }
.ss-val.gain { color: var(--green-d); }
.ss-arrow { font-size: 1.2rem; color: var(--text3); }
.ss-sep { width: 1px; background: var(--border); align-self: stretch; margin: 0 8px; }
.ss-ref { display: flex; gap: 12px; }
.ss-ref-item { text-align: center; }
.ss-ref-lbl { font-size: .58rem; color: var(--text3); font-weight: 500; }
.ss-ref-val { font-size: .85rem; font-weight: 800; color: var(--text2); }

/* lever row */
.lev-row {
  background: var(--white); border: 1px solid var(--border);
  border-radius: 9px; padding: 12px 14px; margin-bottom: 8px;
  display: grid; grid-template-columns: 1fr auto;
  gap: 12px; align-items: start;
  cursor: default; transition: border-color .15s, box-shadow .15s;
}
.lev-row:hover { border-color: var(--green); }
.lev-row.picked { border-color: var(--green); background: var(--green-ll); box-shadow: 0 2px 10px rgba(77,168,107,.1); }
.lev-name { font-size: .8rem; font-weight: 800; color: var(--text); margin-bottom: 3px; display: flex; align-items: center; gap: 6px; }
.lev-desc { font-size: .68rem; color: var(--text2); line-height: 1.45; margin-bottom: 8px; }
.lev-opts { display: flex; gap: 5px; flex-wrap: wrap; }
.lo {
  padding: 5px 10px; border-radius: 6px; border: 1px solid var(--border2);
  font-size: .69rem; font-weight: 600; cursor: pointer;
  background: var(--white); color: var(--text2); transition: all .12s; line-height: 1.3;
  text-align: center;
}
.lo:hover { border-color: var(--green); color: var(--green-d); }
.lo.curr { border-color: var(--orange); color: var(--orange); background: var(--orange-l); }
.lo.pick { border-color: var(--green); color: var(--green-d); background: var(--green-l); font-weight: 700; }
.lo.ref  { border-style: dashed; }
.lev-impact { text-align: right; flex-shrink: 0; }
.lev-impact-val { font-size: .82rem; font-weight: 800; }
.lev-impact-val.good { color: var(--green-d); }
.lev-impact-val.neu  { color: var(--text3); }
.lev-impact-sub { font-size: .58rem; color: var(--text3); margin-top: 2px; }

/* waterfall */
.wf-row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
.wf-lbl { font-size: .69rem; color: var(--text2); width: 112px; flex-shrink: 0; }
.wf-lbl.str { font-weight: 800; color: var(--text); }
.wf-area { flex: 1; height: 15px; background: var(--green-ll); border-radius: 4px; overflow: hidden; position: relative; }
.wf-bar { position: absolute; top: 0; left: 0; height: 100%; border-radius: 4px; transition: width .5s; }
.wf-num { font-size: .67rem; font-weight: 800; width: 38px; text-align: right; flex-shrink: 0; }
.wf-num.good { color: var(--green-d); }
.wf-num.warn { color: var(--orange); }

/* total impact */
.total-impact {
  background: var(--green-d); border-radius: 9px; padding: 13px 14px;
  display: flex; justify-content: space-between; align-items: center; margin-top: 12px;
}
.ti-label { color: rgba(255,255,255,.8); font-size: .74rem; font-weight: 600; }
.ti-val { font-size: 1.7rem; font-weight: 800; color: white; letter-spacing: -.03em; }
.ti-val small { font-size: .75rem; opacity: .7; font-weight: 500; }

/* multi-indicators */
.multi-ind { background: var(--green-ll); border: 1px solid #CBEAA8; border-radius: 9px; padding: 12px; margin-top: 10px; }
.mi-title { font-size: .68rem; font-weight: 800; color: var(--text2); text-transform: uppercase; letter-spacing: .1em; margin-bottom: 8px; }
.mi-row { display: flex; align-items: center; gap: 8px; padding: 5px 0; border-top: 1px solid var(--border); }
.mi-ico { font-size: .85rem; width: 18px; text-align: center; }
.mi-key { flex: 1; font-size: .71rem; color: var(--text2); font-weight: 500; }
.mi-curr { font-size: .69rem; color: var(--text3); text-decoration: line-through; }
.mi-new  { font-size: .72rem; font-weight: 800; color: var(--green-d); margin-left: 5px; }

/* tag pill */
.tag { display: inline-block; padding: 3px 9px; border-radius: 20px; font-size: .62rem; font-weight: 700; }
.tag-green  { background: var(--green-l); color: var(--green-d); border: 1px solid #B8DDA0; }
.tag-teal   { background: var(--teal-l); color: #1F9595; border: 1px solid #A8D8D8; }
.tag-orange { background: var(--orange-l); color: var(--orange); border: 1px solid #F4C899; }
.tag-violet { background: var(--violet-l); color: var(--violet); border: 1px solid #C8B0E8; }
.tag-red    { background: var(--red-l); color: var(--red); border: 1px solid #F0B8B8; }

/* scroll */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text3); }

/* animations */
@keyframes fadeUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }
.page.active > * { animation: fadeUp .25s ease both; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-badge">OP</div>
    <div class="sb-logo-name">Opti<span>meo</span></div>
    <div class="sb-logo-tag">SIA 2026</div>
  </div>

  <div class="sb-section">
    <div class="sb-cat">Navigation</div>
    <div class="sb-item active" id="nav-bench" onclick="goPage('bench',this)">
      <span class="ico">ğŸ“Š</span> Benchmark rÃ©gional
    </div>
    <div class="sb-item" id="nav-itk" onclick="goPage('itk',this)">
      <span class="ico">ğŸŒ¾</span> Mon diagnostic ITK
    </div>
    <div class="sb-item" id="nav-sim" onclick="goPage('sim',this)">
      <span class="ico">âš¡</span> Simulation leviers <span class="badge-count">RF</span>
    </div>
  </div>

  <div class="sb-section">
    <div class="sb-cat">Mon exploitation</div>
    <div class="sb-bloc">
      <div class="sb-bloc-label">Ferme sÃ©lectionnÃ©e</div>
      <div class="sb-bloc-name">EARL du Blavet</div>
      <div class="sb-bloc-sub">BlÃ© tendre Â· Ille-et-Vilaine (35)</div>
      <span class="sb-bloc-tag warn" id="sb-ift-tag">IFT actuel : 2,80</span>
    </div>
  </div>

  <div class="sb-section">
    <div class="sb-cat">ModÃ¨le ML</div>
    <div class="sb-bloc">
      <div class="sb-bloc-label">Random Forest</div>
      <div class="sb-bloc-sub">RÂ² = 0,84 Â· 17 variables Â· 312 fermes</div>
      <span class="sb-bloc-tag ok">âœ“ ModÃ¨le entraÃ®nÃ©</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RIGHT ZONE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="right">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-title" id="topbar-ttl">Benchmark rÃ©gional</div>
    <div class="topbar-chips">
      <div class="topbar-chip"><div class="chip-dot" style="background:var(--green)"></div>BlÃ© tendre</div>
      <div class="topbar-chip"><div class="chip-dot" style="background:var(--teal)"></div>DÃ©p. 35 â€” Ille-et-Vilaine</div>
      <div class="topbar-chip"><div class="chip-dot" style="background:var(--violet)"></div>Bio + Conventionnel</div>
      <div class="topbar-avatar">RM</div>
    </div>
  </div>

  <div class="content">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PAGE 1 â€” BENCHMARK RÃ‰GIONAL              -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page active" id="page-bench">
    <div class="page-hd">
      <div>
        <h1>Benchmark rÃ©gional â€” DÃ©p. 35 Â· BlÃ© tendre</h1>
        <p>Identification des fermes les plus performantes sur l'IFT Â· Campagne 2023â€“2024</p>
      </div>
      <div class="page-hd-right">
        <button class="btn btn-outline" onclick="goPage('itk',document.getElementById('nav-itk'))">Mon ITK â†’</button>
      </div>
    </div>

    <!-- FILTRES -->
    <div class="filters">
      <div class="fg">
        <div class="fg-label">ğŸŒ¾ EspÃ¨ce cultivÃ©e</div>
        <select class="fg-sel">
          <option selected>BlÃ© tendre</option>
          <option>MaÃ¯s grain</option><option>Colza</option>
          <option>Orge d'hiver</option><option>Tournesol</option>
        </select>
      </div>
      <div class="fg">
        <div class="fg-label">ğŸ“ DÃ©partement</div>
        <select class="fg-sel">
          <option selected>35 â€” Ille-et-Vilaine</option>
          <option>29 â€” FinistÃ¨re</option>
          <option>22 â€” CÃ´tes-d'Armor</option>
          <option>56 â€” Morbihan</option>
        </select>
      </div>
      <div class="fg">
        <div class="fg-label">ğŸŒ¿ Type agriculture</div>
        <select class="fg-sel">
          <option selected>Tous (Bio + Conv.)</option>
          <option>Conventionnel seul</option>
          <option>Biologique seul</option>
        </select>
      </div>
      <div class="fg-sep"></div>
      <div class="fg">
        <div class="fg-label">ğŸ¯ Seuil de performance IFT</div>
        <select class="fg-sel">
          <option>âˆ’20% vs mÃ©diane</option>
          <option selected>âˆ’30% vs mÃ©diane</option>
          <option>âˆ’40% vs mÃ©diane</option>
        </select>
      </div>
      <button class="btn btn-green">Appliquer</button>
    </div>

    <!-- SEUIL RETENU -->
    <div style="background:var(--teal-l);border:1px solid #A8D8D8;border-radius:8px;padding:9px 13px;margin-bottom:12px;display:flex;align-items:center;gap:9px;font-size:.73rem;">
      <span style="font-size:1rem">ğŸ¯</span>
      <div>Seuil retenu : <b>IFT â‰¤ 1,61</b> (mÃ©diane 2,30 Ã— 0,70) Â·
        <b style="color:#1F9595">22 fermes rÃ©fÃ©rence</b> identifiÃ©es sur 312 Â·
        <span style="color:var(--text2)">Ces fermes constituent votre feuille de route</span>
      </div>
    </div>

    <!-- KPIs MÃ‰DIANE -->
    <div class="kpi-row">
      <div class="kpi green">
        <div class="kpi-label">ğŸ“‰ MÃ©diane IFT total â€” DÃ©p. 35</div>
        <div class="kpi-val green">2,30 <span style="font-size:.9rem;font-weight:500;color:var(--text3)">IFT</span></div>
        <div class="kpi-sub">312 exploitations Â· BlÃ© tendre Â· Campagne 2023</div>
        <div class="kpi-delta warn">â†‘ +21,7% vs votre exploitation (2,80)</div>
      </div>
      <div class="kpi teal">
        <div class="kpi-label">â± MÃ©diane temps de travail â€” DÃ©p. 35</div>
        <div class="kpi-val teal">18,4 <span style="font-size:.9rem;font-weight:500;color:var(--text3)">h/ha</span></div>
        <div class="kpi-sub">Travail total (manuel + mÃ©canisÃ©)</div>
        <div class="kpi-delta good">â†“ âˆ’7,5% vs votre exploitation (19,9 h/ha)</div>
      </div>
      <div class="kpi violet">
        <div class="kpi-label">â‚¬ MÃ©diane marge brute â€” DÃ©p. 35</div>
        <div class="kpi-val violet">1 240 <span style="font-size:.9rem;font-weight:500;color:var(--text3)">â‚¬/ha</span></div>
        <div class="kpi-sub">Marge brute rÃ©elle hors autoconsommation</div>
        <div class="kpi-delta good">â†“ âˆ’4,0% vs votre exploitation (1 292 â‚¬/ha)</div>
      </div>
    </div>

    <!-- MAIN : PROFIL + TABLE -->
    <div class="g64">

      <!-- LEFT : PROFIL PRATIQUES -->
      <div class="card">
        <div class="card-h">
          <div class="card-title">ğŸ” Profil des pratiques â€” 22 fermes rÃ©fÃ©rence (IFT â‰¤ 1,61)</div>
          <span class="tag tag-teal">IFT âˆ’30%</span>
        </div>
        <div class="lev-grid">

          <!-- Travail du sol (QUALI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">Travail du sol</div><div class="lt-var">type_de_travail_du_sol</div></div>
              <span class="badge-type bt-ql">Qualitatif</span>
            </div>
            <div class="fr"><div class="fr-lbl">Semis direct</div><div class="fr-trk"><div class="fr-fil top" style="width:59%"></div></div><div class="fr-pct">59%</div></div>
            <div class="fr"><div class="fr-lbl">TCS</div><div class="fr-trk"><div class="fr-fil" style="width:32%"></div></div><div class="fr-pct">32%</div></div>
            <div class="fr"><div class="fr-lbl">Labour</div><div class="fr-trk"><div class="fr-fil" style="width:9%"></div></div><div class="fr-pct">9%</div></div>
          </div>

          <!-- DÃ©sherbage mÃ©ca (QUALI + QUANTI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">DÃ©sherbage mÃ©canique</div><div class="lt-var">utili_desherbage_meca</div></div>
              <span class="badge-type bt-ql">Qualitatif</span>
            </div>
            <div class="fr"><div class="fr-lbl">Oui â€” systÃ©matique</div><div class="fr-trk"><div class="fr-fil top" style="width:82%"></div></div><div class="fr-pct">82%</div></div>
            <div class="fr"><div class="fr-lbl">Non</div><div class="fr-trk"><div class="fr-fil" style="width:18%"></div></div><div class="fr-pct">18%</div></div>
            <div style="font-size:.62rem;color:var(--text2);margin-top:5px">MÃ©diane passages : <b style="color:var(--green-d)">3,2</b> vs 0,4 (ensemble)</div>
          </div>

          <!-- NB Rotation (QUANTI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">NB Rotation</div><div class="lt-var">nb_rotation</div></div>
              <span class="badge-type bt-q">Quantitatif</span>
            </div>
            <div class="qv">4,8 <span style="font-size:.7rem;font-weight:400;color:var(--text3)">cultures</span></div>
            <div class="qvs">vs 3,1 â€” ensemble dÃ©partement</div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--text3)">Ensemble</div><div class="qbar-trk"><div class="qbar-fil" style="width:62%;background:var(--text3)"></div></div></div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--green-d)">RÃ©fÃ©rence</div><div class="qbar-trk"><div class="qbar-fil" style="width:96%;background:var(--green)"></div></div></div>
          </div>

          <!-- Recours biocontrÃ´le (QUALI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">Recours BiocontrÃ´le</div><div class="lt-var">recours_biocontrole</div></div>
              <span class="badge-type bt-ql">Qualitatif</span>
            </div>
            <div class="fr"><div class="fr-lbl">Oui â€” complet</div><div class="fr-trk"><div class="fr-fil top" style="width:68%"></div></div><div class="fr-pct">68%</div></div>
            <div class="fr"><div class="fr-lbl">Partiel</div><div class="fr-trk"><div class="fr-fil" style="width:27%"></div></div><div class="fr-pct">27%</div></div>
            <div class="fr"><div class="fr-lbl">Aucun</div><div class="fr-trk"><div class="fr-fil" style="width:5%"></div></div><div class="fr-pct">5%</div></div>
          </div>

          <!-- Fertilisation N (QUANTI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">Fertilisation N</div><div class="lt-var">ferti_n_tot</div></div>
              <span class="badge-type bt-q">Quantitatif</span>
            </div>
            <div class="qv">142 <span style="font-size:.7rem;font-weight:400;color:var(--text3)">kgN/ha</span></div>
            <div class="qvs">vs 185 kgN/ha â€” ensemble</div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--text3)">Ensemble</div><div class="qbar-trk"><div class="qbar-fil" style="width:100%;background:var(--text3)"></div></div></div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--green-d)">RÃ©fÃ©rence</div><div class="qbar-trk"><div class="qbar-fil" style="width:77%;background:var(--green)"></div></div></div>
          </div>

          <!-- VariÃ©tÃ© rÃ©sistante (QUALI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">VariÃ©tÃ© rÃ©sistante</div><div class="lt-var">variete_resistante</div></div>
              <span class="badge-type bt-ql">Qualitatif</span>
            </div>
            <div class="fr"><div class="fr-lbl">TrÃ¨s rÃ©sistante</div><div class="fr-trk"><div class="fr-fil top" style="width:73%"></div></div><div class="fr-pct">73%</div></div>
            <div class="fr"><div class="fr-lbl">RÃ©sistance partielle</div><div class="fr-trk"><div class="fr-fil" style="width:18%"></div></div><div class="fr-pct">18%</div></div>
            <div class="fr"><div class="fr-lbl">Standard</div><div class="fr-trk"><div class="fr-fil" style="width:9%"></div></div><div class="fr-pct">9%</div></div>
          </div>

          <!-- Couverts hivernaux (QUALI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">Couverts hivernaux</div><div class="lt-var">couvert_hivernaux</div></div>
              <span class="badge-type bt-ql">Qualitatif</span>
            </div>
            <div class="fr"><div class="fr-lbl">SystÃ©matique</div><div class="fr-trk"><div class="fr-fil top" style="width:86%"></div></div><div class="fr-pct">86%</div></div>
            <div class="fr"><div class="fr-lbl">Partiel</div><div class="fr-trk"><div class="fr-fil" style="width:11%"></div></div><div class="fr-pct">11%</div></div>
            <div class="fr"><div class="fr-lbl">Absent</div><div class="fr-trk"><div class="fr-fil" style="width:3%"></div></div><div class="fr-pct">3%</div></div>
          </div>

          <!-- Carburant (QUANTI) -->
          <div class="lt">
            <div class="lt-h">
              <div><div class="lt-name">Consommation carburant</div><div class="lt-var">conso_carburant</div></div>
              <span class="badge-type bt-q">Quantitatif</span>
            </div>
            <div class="qv">68 <span style="font-size:.7rem;font-weight:400;color:var(--text3)">L/ha</span></div>
            <div class="qvs">vs 94 L/ha â€” ensemble dÃ©partement</div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--text3)">Ensemble</div><div class="qbar-trk"><div class="qbar-fil" style="width:100%;background:var(--text3)"></div></div></div>
            <div class="qbar-row"><div class="qbar-lbl" style="color:var(--green-d)">RÃ©fÃ©rence</div><div class="qbar-trk"><div class="qbar-fil" style="width:72%;background:var(--green)"></div></div></div>
          </div>

        </div><!-- /lev-grid -->
      </div>

      <!-- RIGHT : FERMES RÃ‰FÃ‰RENCE -->
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div class="card">
          <div class="card-h">
            <div class="card-title">ğŸ† 22 fermes rÃ©fÃ©rence</div>
            <span class="badge bg-green">IFT â‰¤ 1,61</span>
          </div>
          <table class="tbl">
            <thead>
              <tr><th>#</th><th>Exploitation</th><th>IFT</th><th>Ã‰cart</th></tr>
            </thead>
            <tbody>
              <tr><td class="tbl-rank">#1</td><td><div class="tbl-name">GAEC Kervran</div><div class="tbl-sub">Bio Â· 89 ha Â· SD</div></td><td style="font-weight:800;color:var(--green-d)">0,82</td><td><span class="badge bg-green">âˆ’64%</span></td></tr>
              <tr><td class="tbl-rank">#2</td><td><div class="tbl-name">EARL Tanguy</div><div class="tbl-sub">Conv. Â· 124 ha</div></td><td style="font-weight:800;color:var(--green-d)">0,98</td><td><span class="badge bg-green">âˆ’57%</span></td></tr>
              <tr><td class="tbl-rank">#3</td><td><div class="tbl-name">SAS Morvan</div><div class="tbl-sub">Conv. Â· 67 ha Â· TCS</div></td><td style="font-weight:800;color:var(--green-d)">1,10</td><td><span class="badge bg-green">âˆ’52%</span></td></tr>
              <tr><td class="tbl-rank">#4</td><td><div class="tbl-name">SCEA Le Goff</div><div class="tbl-sub">Conv. Â· 210 ha</div></td><td style="font-weight:800;color:var(--green-d)">1,22</td><td><span class="badge bg-green">âˆ’47%</span></td></tr>
              <tr><td class="tbl-rank">#5</td><td><div class="tbl-name">GAEC QuÃ©fÃ©lec</div><div class="tbl-sub">Bio Â· 155 ha Â· SD</div></td><td style="font-weight:800;color:var(--green-d)">1,28</td><td><span class="badge bg-green">âˆ’44%</span></td></tr>
              <tr><td class="tbl-rank">#6</td><td><div class="tbl-name">EARL Jouan</div><div class="tbl-sub">Conv. Â· 98 ha</div></td><td style="font-weight:800;color:var(--green-d)">1,35</td><td><span class="badge bg-green">âˆ’41%</span></td></tr>
              <tr><td class="tbl-rank">#7</td><td><div class="tbl-name">SAS Penglaou</div><div class="tbl-sub">Conv. Â· 78 ha</div></td><td style="font-weight:800;color:var(--green-d)">1,41</td><td><span class="badge bg-green">âˆ’39%</span></td></tr>
              <tr><td class="tbl-rank">#8</td><td><div class="tbl-name">EARL Beaudouin</div><div class="tbl-sub">Conv. Â· 190 ha</div></td><td style="font-weight:800;color:var(--green-d)">1,48</td><td><span class="badge bg-green">âˆ’36%</span></td></tr>
              <tr><td class="tbl-rank">Â·Â·Â·</td><td colspan="3" style="font-size:.67rem;color:var(--text3)">14 autres Â· IFT entre 1,49 et 1,61</td></tr>
            </tbody>
          </table>
        </div>
        <div style="background:var(--green-ll);border:1px solid #CBEAA8;border-radius:8px;padding:11px 13px;font-size:.72rem;color:var(--text2);line-height:1.55;">
          <div style="font-weight:800;color:var(--green-d);margin-bottom:4px;">ğŸ’¡ Signal dominant</div>
          Ces 22 fermes pratiquent massivement le <b>semis direct ou TCS</b>, le <b>dÃ©sherbage mÃ©canique</b> (3+ passages), une <b>rotation longue</b> (â‰¥5 cultures) et des <b>variÃ©tÃ©s trÃ¨s rÃ©sistantes</b>.
        </div>
        <button class="btn btn-green" style="width:100%;padding:9px;font-size:.8rem;justify-content:center" onclick="goPage('itk',document.getElementById('nav-itk'))">â†’ Renseigner mon ITK</button>
      </div>

    </div><!-- /g64 -->
  </div><!-- /page-bench -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PAGE 2 â€” DIAGNOSTIC ITK                  -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-itk">
    <div class="page-hd">
      <div>
        <h1>Mon diagnostic ITK</h1>
        <p>Renseignez votre itinÃ©raire technique Â· Le modÃ¨le Random Forest prÃ©dit votre IFT en temps rÃ©el</p>
      </div>
      <div class="page-hd-right">
        <div class="steps">
          <div class="step done"><div class="step-n">âœ“</div>Benchmark</div>
          <span class="step-sep">â€º</span>
          <div class="step active"><div class="step-n">2</div>Mon ITK</div>
          <span class="step-sep">â€º</span>
          <div class="step"><div class="step-n">3</div>Simulation</div>
        </div>
        <button class="btn btn-outline" onclick="resetForm()">â†º Reset</button>
        <button class="btn btn-green" onclick="goPage('sim',document.getElementById('nav-sim'))">Simuler â†’</button>
      </div>
    </div>

    <div class="itk-layout">
      <!-- FORM -->
      <div class="card" style="padding:16px 18px;">

        <!-- Rotation & assolement -->
        <div class="fsec">
          <div class="fsec-title">ğŸŒ¾ Rotation & assolement</div>
          <div class="fgrid">
            <div class="fld">
              <div class="flbl">NB Rotation <span class="fref">RÃ©f : 4,8 cultures</span></div>
              <div class="slider-w">
                <div class="slider-top"><span class="cap">1 culture</span><span class="slider-val" id="sv-rot">3</span><span class="cap">8+</span></div>
                <input type="range" class="fslider" id="f-rot" min="1" max="8" value="3" oninput="document.getElementById('sv-rot').textContent=this.value;recalc()">
              </div>
            </div>
            <div class="fld">
              <div class="flbl">Couverts hivernaux <span class="fref">RÃ©f : SystÃ©matique</span></div>
              <div class="chips" id="c-couv">
                <div class="chip" onclick="chk(this,'c-couv')">Absent</div>
                <div class="chip on" onclick="chk(this,'c-couv')">Partiel</div>
                <div class="chip" onclick="chk(this,'c-couv')">SystÃ©matique</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Travail du sol -->
        <div class="fsec">
          <div class="fsec-title">ğŸšœ Travail du sol & dÃ©sherbage</div>
          <div class="fgrid">
            <div class="fld">
              <div class="flbl">Type travail du sol <span class="fref">RÃ©f : SD (59%)</span></div>
              <div class="chips" id="c-sol">
                <div class="chip on" onclick="chk(this,'c-sol');recalc()">Labour</div>
                <div class="chip" onclick="chk(this,'c-sol');recalc()">TCS</div>
                <div class="chip" onclick="chk(this,'c-sol');recalc()">Semis direct</div>
              </div>
            </div>
            <div class="fld">
              <div class="flbl">DÃ©sherbage mÃ©canique <span class="fref">RÃ©f : Oui (82%)</span></div>
              <div class="chips" id="c-desh">
                <div class="chip on" onclick="chk(this,'c-desh');recalc()">Non</div>
                <div class="chip" onclick="chk(this,'c-desh');recalc()">Oui â€” partiel</div>
                <div class="chip" onclick="chk(this,'c-desh');recalc()">Oui â€” complet</div>
              </div>
            </div>
            <div class="fld">
              <div class="flbl">Nb passages dÃ©sherb. mÃ©ca <span class="fref">RÃ©f : 3,2</span></div>
              <div class="slider-w">
                <div class="slider-top"><span class="cap">0</span><span class="slider-val" id="sv-desh">0</span><span class="cap">6</span></div>
                <input type="range" class="fslider" id="f-desh" min="0" max="6" value="0" oninput="document.getElementById('sv-desh').textContent=this.value;recalc()">
              </div>
            </div>
          </div>
        </div>

        <!-- Protection phyto -->
        <div class="fsec">
          <div class="fsec-title">ğŸ§ª Protection phytosanitaire</div>
          <div class="fgrid">
            <div class="fld">
              <div class="flbl">IFT Chimique actuel</div>
              <input type="number" class="finp" id="f-iftc" value="2.40" step="0.05" min="0" onchange="recalc()">
            </div>
            <div class="fld">
              <div class="flbl">IFT BiocontrÃ´le actuel <span class="fref">RÃ©f : 0,35</span></div>
              <input type="number" class="finp" id="f-iftb" value="0.05" step="0.05" min="0" onchange="recalc()">
            </div>
            <div class="fld">
              <div class="flbl">VariÃ©tÃ© rÃ©sistante <span class="fref">RÃ©f : TrÃ¨s rÃ©sistante</span></div>
              <select class="fsel" id="f-var" onchange="recalc()">
                <option value="2" selected>Standard (sans rÃ©sistance)</option>
                <option value="1">RÃ©sistance partielle</option>
                <option value="0">TrÃ¨s rÃ©sistante</option>
              </select>
            </div>
            <div class="fld">
              <div class="flbl">Recours BiocontrÃ´le <span class="fref">RÃ©f : Oui (68%)</span></div>
              <div class="chips" id="c-bio">
                <div class="chip on" onclick="chk(this,'c-bio');recalc()">Aucun</div>
                <div class="chip" onclick="chk(this,'c-bio');recalc()">Partiel</div>
                <div class="chip" onclick="chk(this,'c-bio');recalc()">SystÃ©matique</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fertilisation -->
        <div class="fsec">
          <div class="fsec-title">ğŸŒ¿ Fertilisation</div>
          <div class="fgrid t3">
            <div class="fld">
              <div class="flbl">N total (kgN/ha) <span class="fref">RÃ©f : 142</span></div>
              <div class="slider-w">
                <div class="slider-top"><span class="cap">0</span><span class="slider-val" id="sv-n">185</span><span class="cap">300</span></div>
                <input type="range" class="fslider" id="f-n" min="0" max="300" value="185" oninput="document.getElementById('sv-n').textContent=this.value;recalc()">
              </div>
            </div>
            <div class="fld">
              <div class="flbl">Pâ‚‚Oâ‚… (kg/ha)</div>
              <div class="slider-w">
                <div class="slider-top"><span class="cap">0</span><span class="slider-val" id="sv-p">60</span><span class="cap">150</span></div>
                <input type="range" class="fslider" id="f-p" min="0" max="150" value="60" oninput="document.getElementById('sv-p').textContent=this.value">
              </div>
            </div>
            <div class="fld">
              <div class="flbl">Kâ‚‚O (kg/ha)</div>
              <div class="slider-w">
                <div class="slider-top"><span class="cap">0</span><span class="slider-val" id="sv-k">70</span><span class="cap">200</span></div>
                <input type="range" class="fslider" id="f-k" min="0" max="200" value="70" oninput="document.getElementById('sv-k').textContent=this.value">
              </div>
            </div>
          </div>
        </div>

        <!-- Ã‰conomie & Travail -->
        <div class="fsec" style="margin-bottom:0">
          <div class="fsec-title">ğŸ“Š Ã‰conomie & travail</div>
          <div class="fgrid">
            <div class="fld">
              <div class="flbl">Marge brute (â‚¬/ha) <span class="fref">RÃ©f : 1 240</span></div>
              <input type="number" class="finp" id="f-mb" value="1292" step="10" onchange="recalc()">
            </div>
            <div class="fld">
              <div class="flbl">Temps de travail (h/ha) <span class="fref">RÃ©f : 18,4</span></div>
              <input type="number" class="finp" id="f-tps" value="19.9" step="0.5" onchange="recalc()">
            </div>
            <div class="fld">
              <div class="flbl">Nombre UTH</div>
              <input type="number" class="finp" id="f-uth" value="2.0" step="0.5">
            </div>
            <div class="fld">
              <div class="flbl">Carburant (L/ha) <span class="fref">RÃ©f : 68</span></div>
              <input type="number" class="finp" id="f-carb" value="94" step="1" onchange="recalc()">
            </div>
            <div class="fld">
              <div class="flbl">Consommation eau (mÂ³/ha)</div>
              <input type="number" class="finp" id="f-eau" value="0" step="10">
            </div>
          </div>
        </div>

      </div><!-- /card form -->

      <!-- SIDEBAR RESULT -->
      <div>
        <!-- IFT prÃ©dit -->
        <div class="ift-card">
          <div class="ift-card-lbl">IFT total prÃ©dit Â· ModÃ¨le RF</div>
          <div class="ift-card-val" id="itk-val" style="color:var(--orange)">2,80<span class="ift-card-unit">IFT</span></div>
          <div class="gauge-wrap">
            <div class="gauge-trk">
              <div class="gauge-fil" id="itk-gauge" style="width:70%;background:var(--orange)"></div>
            </div>
            <div class="gauge-tks"><span>0</span><span>RÃ©f 1,61</span><span>MÃ©d 2,3</span><span>4+</span></div>
          </div>
          <div class="ift-card-sub">IFT chimique + IFT biocontrÃ´le</div>
        </div>

        <!-- DÃ©composition -->
        <div class="card" style="margin-bottom:10px">
          <div class="card-title" style="margin-bottom:10px">ğŸ“‰ DÃ©composition IFT</div>
          <div class="cr"><span class="k">IFT Chimique</span><span class="v v-warn" id="itk-chim">2,40</span></div>
          <div class="cr"><span class="k">IFT BiocontrÃ´le</span><span class="v v-teal" id="itk-bio">0,05</span></div>
          <div class="cr"><span class="k">vs mÃ©diane (2,30)</span><span class="v" id="itk-vmed" style="color:var(--orange)">+21,7%</span></div>
          <div class="cr"><span class="k">vs rÃ©fÃ©rence (1,61)</span><span class="v v-bad" id="itk-vref">+73,9%</span></div>
          <div class="cr"><span class="k">Potentiel estimÃ©</span><span class="v v-good">âˆ’40 Ã  âˆ’45%</span></div>
        </div>

        <!-- Autres indicateurs -->
        <div class="card card-bg-green">
          <div class="card-title" style="margin-bottom:10px">ğŸŒ Indicateurs complÃ©mentaires</div>
          <div class="cr"><span class="k">â± Temps de travail</span><span class="v v-warn" id="itk-tps">19,9 h/ha</span></div>
          <div class="cr"><span class="k">â‚¬ Marge brute</span><span class="v" style="color:var(--violet)" id="itk-mb">1 292 â‚¬/ha</span></div>
          <div class="cr"><span class="k">â›½ Carburant</span><span class="v v-warn" id="itk-carb">94 L/ha</span></div>
        </div>

        <button class="btn btn-green" style="width:100%;padding:9px;margin-top:10px;font-size:.78rem;justify-content:center" onclick="goPage('sim',document.getElementById('nav-sim'))">âš¡ Simuler les leviers â†’</button>
      </div>

    </div><!-- /itk-layout -->
  </div><!-- /page-itk -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PAGE 3 â€” SIMULATION LEVIERS              -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-sim">
    <div class="page-hd">
      <div>
        <h1>Simulation des leviers agronomiques</h1>
        <p>SÃ©lectionnez les pratiques des fermes rÃ©fÃ©rence que vous seriez prÃªt Ã  mobiliser Â· Recalcul RF en temps rÃ©el</p>
      </div>
      <div class="page-hd-right">
        <div class="steps">
          <div class="step done"><div class="step-n">âœ“</div>Benchmark</div>
          <span class="step-sep">â€º</span>
          <div class="step done"><div class="step-n">âœ“</div>Mon ITK</div>
          <span class="step-sep">â€º</span>
          <div class="step active"><div class="step-n">3</div>Simulation</div>
        </div>
        <div id="sim-tag" class="tag tag-orange">ScÃ©nario en cours</div>
        <button class="btn btn-outline" onclick="resetSim()">â†º RÃ©initialiser</button>
        <button class="btn btn-teal">ğŸ’¾ Sauvegarder</button>
      </div>
    </div>

    <!-- BARRE RÃ‰SUMÃ‰ -->
    <div class="sim-summary">
      <div class="ss-group">
        <div class="ss-lbl">IFT actuel</div>
        <div class="ss-val current" id="ss-curr">2,80</div>
      </div>
      <div class="ss-arrow">â†’</div>
      <div class="ss-group">
        <div class="ss-lbl">IFT simulÃ©</div>
        <div class="ss-val simulated" id="ss-sim">2,80</div>
      </div>
      <div class="ss-arrow">Â·</div>
      <div class="ss-group">
        <div class="ss-lbl">AmÃ©lioration</div>
        <div class="ss-val gain" id="ss-gain">â€”</div>
      </div>
      <div class="ss-sep"></div>
      <div class="ss-ref">
        <div class="ss-ref-item">
          <div class="ss-ref-lbl">MÃ©diane DÃ©p. 35</div>
          <div class="ss-ref-val" style="color:var(--text2)">2,30</div>
        </div>
        <div class="ss-ref-item">
          <div class="ss-ref-lbl">Cible rÃ©fÃ©rence</div>
          <div class="ss-ref-val" style="color:var(--green-d)">1,61</div>
        </div>
        <div class="ss-ref-item">
          <div class="ss-ref-lbl">Leviers actifs</div>
          <div class="ss-ref-val" id="ss-cnt" style="color:var(--teal)">0</div>
        </div>
      </div>
    </div>

    <div class="sim-layout">
      <!-- LEFT : LEVIER CARDS -->
      <div>
        <div style="font-size:.71rem;color:var(--text2);margin-bottom:10px;">
          Observez les pratiques des 22 fermes rÃ©fÃ©rence et sÃ©lectionnez les leviers Ã  mobiliser :
        </div>

        <!-- L1 : Rotation -->
        <div class="lev-row" id="lc-rot">
          <div>
            <div class="lev-name">ğŸŒ¾ NB Rotation <span class="badge-type bt-q">Quantitatif</span></div>
            <div class="lev-desc">Les fermes rÃ©fÃ©rence pratiquent une rotation longue (mÃ©diane <b>4,8 cultures</b> vs 3,1 ensemble), rÃ©duisant la pression adventice et maladie. Votre situation : <b>3 cultures</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">3 cultures Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'rot',-0.22)">4 cultures</div>
              <div class="lo ref" onclick="simPick(this,'rot',-0.38)">5+ cultures â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-rot">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L2 : Travail du sol -->
        <div class="lev-row" id="lc-sol">
          <div>
            <div class="lev-name">ğŸšœ Travail du sol <span class="badge-type bt-ql">Qualitatif</span></div>
            <div class="lev-desc"><b>59%</b> des fermes rÃ©fÃ©rence sont en semis direct, 32% en TCS. Le labour systÃ©matique augmente la pression adventice et les herbicides. Votre situation : <b>Labour</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">Labour Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'sol',-0.28)">TCS</div>
              <div class="lo ref" onclick="simPick(this,'sol',-0.45)">Semis direct â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-sol">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L3 : DÃ©sherbage mÃ©ca -->
        <div class="lev-row" id="lc-desh">
          <div>
            <div class="lev-name">âš™ï¸ DÃ©sherbage mÃ©canique <span class="badge-type bt-ql">Qualitatif</span></div>
            <div class="lev-desc"><b>82%</b> des fermes rÃ©fÃ©rence pratiquent le dÃ©sherbage mÃ©canique (mÃ©diane 3,2 passages). RÃ©duit directement l'IFT herbicide. Votre situation : <b>Aucun</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">Non Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'desh',-0.30)">Oui â€” partiel (2 pass.)</div>
              <div class="lo ref" onclick="simPick(this,'desh',-0.52)">Oui â€” complet â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-desh">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L4 : VariÃ©tÃ© rÃ©sistante -->
        <div class="lev-row" id="lc-var">
          <div>
            <div class="lev-name">ğŸ§¬ VariÃ©tÃ© rÃ©sistante <span class="badge-type bt-ql">Qualitatif</span></div>
            <div class="lev-desc"><b>73%</b> des fermes rÃ©fÃ©rence utilisent des variÃ©tÃ©s trÃ¨s rÃ©sistantes aux maladies fongiques, rÃ©duisant le nombre d'interventions. Votre situation : <b>Standard</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">Standard Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'var',-0.18)">RÃ©sistance partielle</div>
              <div class="lo ref" onclick="simPick(this,'var',-0.35)">TrÃ¨s rÃ©sistante â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-var">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L5 : BiocontrÃ´le -->
        <div class="lev-row" id="lc-bio">
          <div>
            <div class="lev-name">ğŸŒ¿ Recours BiocontrÃ´le <span class="badge-type bt-ql">Qualitatif</span></div>
            <div class="lev-desc"><b>68%</b> des fermes rÃ©fÃ©rence ont un recours complet au biocontrÃ´le, substituant partiellement les traitements chimiques. Votre situation : <b>Aucun</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">Aucun Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'bio',-0.20)">Partiel</div>
              <div class="lo ref" onclick="simPick(this,'bio',-0.42)">SystÃ©matique â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-bio">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L6 : Couverts -->
        <div class="lev-row" id="lc-couv">
          <div>
            <div class="lev-name">ğŸŒ± Couverts hivernaux <span class="badge-type bt-ql">Qualitatif</span></div>
            <div class="lev-desc"><b>86%</b> des fermes rÃ©fÃ©rence ont des couverts hivernaux systÃ©matiques, rÃ©duisant la pression adventice et les herbicides. Votre situation : <b>Partiel</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">Partiel Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'couv',-0.14)">SystÃ©matique â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-couv">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <!-- L7 : Fertilisation N -->
        <div class="lev-row" id="lc-n">
          <div>
            <div class="lev-name">ğŸ§ª Fertilisation N <span class="badge-type bt-q">Quantitatif</span></div>
            <div class="lev-desc">Les fermes rÃ©fÃ©rence apportent <b>142 kgN/ha</b> (mÃ©diane) vs 185 kg pour l'ensemble. La rÃ©duction de l'azote limite la vigueur et la pression fongique. Votre situation : <b>185 kgN/ha</b>.</div>
            <div class="lev-opts">
              <div class="lo curr">185 kgN/ha Â· actuel</div>
              <div class="lo ref" onclick="simPick(this,'n',-0.10)">160 kgN/ha</div>
              <div class="lo ref" onclick="simPick(this,'n',-0.18)">142 kgN/ha â˜… rÃ©f.</div>
            </div>
          </div>
          <div class="lev-impact">
            <div class="lev-impact-val neu" id="li-n">â€”</div>
            <div class="lev-impact-sub">impact IFT</div>
          </div>
        </div>

        <div style="padding:9px 12px;background:var(--green-ll);border:1px solid #CBEAA8;border-radius:7px;font-size:.67rem;color:var(--text2);line-height:1.5;margin-top:4px;">
          <b style="color:var(--green-d)">â˜…</b> = modalitÃ© dominante chez les 22 fermes rÃ©fÃ©rence Â·
          <b style="color:var(--orange)">Actuel</b> = votre pratique actuelle (page 02) Â·
          Les impacts sont estimÃ©s par le modÃ¨le Random Forest entraÃ®nÃ© sur l'IFT total.
        </div>
      </div><!-- /left -->

      <!-- RIGHT : PANNEAU RÃ‰SULTATS -->
      <div>
        <!-- Waterfall -->
        <div class="card" style="margin-bottom:11px;">
          <div class="card-title" style="margin-bottom:11px;">ğŸ“Š DÃ©composition de la rÃ©duction</div>
          <div id="waterfall">
            <div class="wf-row">
              <div class="wf-lbl">IFT de dÃ©part</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--orange);opacity:.7;width:70%"></div></div>
              <div class="wf-num warn">2,80</div>
            </div>
            <div class="wf-row" id="wf-rot" style="display:none">
              <div class="wf-lbl">â€” Rotation</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-rot"></div></div>
              <div class="wf-num good" id="wfv-rot"></div>
            </div>
            <div class="wf-row" id="wf-sol" style="display:none">
              <div class="wf-lbl">â€” Travail sol</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-sol"></div></div>
              <div class="wf-num good" id="wfv-sol"></div>
            </div>
            <div class="wf-row" id="wf-desh" style="display:none">
              <div class="wf-lbl">â€” DÃ©sherbage</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-desh"></div></div>
              <div class="wf-num good" id="wfv-desh"></div>
            </div>
            <div class="wf-row" id="wf-var" style="display:none">
              <div class="wf-lbl">â€” VariÃ©tÃ©</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-var"></div></div>
              <div class="wf-num good" id="wfv-var"></div>
            </div>
            <div class="wf-row" id="wf-bio" style="display:none">
              <div class="wf-lbl">â€” BiocontrÃ´le</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--teal)" id="wfb-bio"></div></div>
              <div class="wf-num good" id="wfv-bio"></div>
            </div>
            <div class="wf-row" id="wf-couv" style="display:none">
              <div class="wf-lbl">â€” Couverts</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-couv"></div></div>
              <div class="wf-num good" id="wfv-couv"></div>
            </div>
            <div class="wf-row" id="wf-n" style="display:none">
              <div class="wf-lbl">â€” Fertilisation N</div>
              <div class="wf-area"><div class="wf-bar" style="background:var(--green)" id="wfb-n"></div></div>
              <div class="wf-num good" id="wfv-n"></div>
            </div>
            <div class="wf-row">
              <div class="wf-lbl str">IFT simulÃ©</div>
              <div class="wf-area"><div class="wf-bar" id="wfb-fin" style="transition:width .5s"></div></div>
              <div class="wf-num" id="wfv-fin" style="color:var(--green-d);font-size:.78rem;font-weight:800">2,80</div>
            </div>
          </div>
          <div class="total-impact">
            <div>
              <div class="ti-label">RÃ©duction IFT totale</div>
              <div style="font-size:.62rem;color:rgba(255,255,255,.55);margin-top:2px" id="sim-cnt-lbl">0 levier activÃ©</div>
            </div>
            <div class="ti-val" id="sim-total">â€”<small> IFT</small></div>
          </div>
        </div>

        <!-- Positionnement -->
        <div class="card" style="margin-bottom:11px;">
          <div class="card-title" style="margin-bottom:10px;">ğŸ¯ Positionnement simulÃ©</div>
          <div class="cr"><span class="k">IFT simulÃ©</span><span class="v v-teal" id="sr-sim">2,80</span></div>
          <div class="cr"><span class="k">vs mÃ©diane DÃ©p. 35 (2,30)</span><span class="v" id="sr-med" style="color:var(--orange)">+21,7%</span></div>
          <div class="cr"><span class="k">vs fermes rÃ©fÃ©rence (1,61)</span><span class="v v-bad" id="sr-ref">+73,9%</span></div>
          <div class="cr"><span class="k">vs ma situation actuelle</span><span class="v v-neu" id="sr-act">â€”</span></div>
        </div>

        <!-- Multi-indicateurs -->
        <div class="multi-ind">
          <div class="mi-title">ğŸŒ Vision combinÃ©e multi-indicateurs</div>
          <div class="mi-row">
            <div class="mi-ico">ğŸ“‰</div>
            <div class="mi-key">IFT Total</div>
            <span class="mi-curr" id="mi-ift-c">2,80</span>
            <span class="mi-new" id="mi-ift-n">â†’ 2,80</span>
          </div>
          <div class="mi-row">
            <div class="mi-ico">â±</div>
            <div class="mi-key">Temps de travail</div>
            <span class="mi-curr">19,9 h/ha</span>
            <span class="mi-new" id="mi-tps-n">â†’ 19,9 h/ha</span>
          </div>
          <div class="mi-row">
            <div class="mi-ico">â‚¬</div>
            <div class="mi-key">Marge brute</div>
            <span class="mi-curr">1 292 â‚¬/ha</span>
            <span class="mi-new" id="mi-mb-n">â†’ 1 292 â‚¬/ha</span>
          </div>
          <div class="mi-row">
            <div class="mi-ico">â›½</div>
            <div class="mi-key">Carburant</div>
            <span class="mi-curr">94 L/ha</span>
            <span class="mi-new" id="mi-carb-n">â†’ 94 L/ha</span>
          </div>
          <div style="margin-top:7px;font-size:.61rem;color:var(--text3)">
            Extension future : ğŸ’§ eau Â· ğŸŒ¿ biodiversitÃ© Â· ğŸŒ¡ carbone Â· âš  HRI1
          </div>
        </div>

      </div><!-- /right -->
    </div><!-- /sim-layout -->
  </div><!-- /page-sim -->

  </div><!-- /content -->
</div><!-- /right -->

<script>
// â•â•â• NAVIGATION â•â•â•
const PAGE_TITLES = { bench:'Benchmark rÃ©gional', itk:'Mon diagnostic ITK', sim:'Simulation des leviers' };
function goPage(id, navEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sb-item').forEach(i => i.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  if (navEl) navEl.classList.add('active');
  document.getElementById('topbar-ttl').textContent = PAGE_TITLES[id] || '';
}

// â•â•â• CHIP SELECT â•â•â•
function chk(el, gid) {
  document.querySelectorAll('#' + gid + ' .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  recalc();
}
function chipIdx(gid) {
  const chips = [...document.querySelectorAll('#' + gid + ' .chip')];
  return chips.findIndex(c => c.classList.contains('on'));
}

// â•â•â• SNAPSHOT ITK â†’ Ã©tat courant lu par la simulation â•â•â•
// Stocke les valeurs lisibles de l'ITK pour alimenter les labels dans la page sim
window.itkState = {
  rot: 3, solLabel: 'Labour', deshLabel: 'Non', varLabel: 'Standard',
  bioLabel: 'Aucun', couvLabel: 'Partiel', nVal: 185,
  mb: 1292, tps: 19.9, carb: 94
};

// â•â•â• MISE Ã€ JOUR DES LABELS "actuel" dans la page Simulation â•â•â•
// AppelÃ©e Ã  chaque recalc() pour que la page sim reflÃ¨te l'ITK courant
function syncSimLabels() {
  const s = window.itkState;

  // DÃ©finition des leviers : [id, label actuel, unitÃ©/suffixe]
  const updates = [
    { id: 'rot',  curr: s.rot + ' culture' + (s.rot > 1 ? 's' : '') },
    { id: 'sol',  curr: s.solLabel },
    { id: 'desh', curr: s.deshLabel },
    { id: 'var',  curr: s.varLabel },
    { id: 'bio',  curr: s.bioLabel },
    { id: 'couv', curr: s.couvLabel },
    { id: 'n',    curr: s.nVal + ' kgN/ha' },
  ];

  updates.forEach(({ id, curr }) => {
    // Mettre Ã  jour le bouton .lo.curr dans chaque carte
    const card = document.getElementById('lc-' + id);
    if (!card) return;
    const currBtn = card.querySelector('.lo.curr');
    if (currBtn) currBtn.textContent = curr + ' Â· actuel';

    // Mettre Ã  jour la description "Votre situation : ..."
    const desc = card.querySelector('.lev-desc');
    if (desc) {
      // Remplacer uniquement la partie dynamique entre le dernier <b> et la fin
      desc.innerHTML = desc.innerHTML.replace(
        /Votre situation\s*:\s*<b>[^<]*<\/b>/,
        'Votre situation\u00a0: <b>' + curr + '</b>'
      );
    }
  });
}

// â•â•â• ITK RECALC (proxy RF linÃ©aire) â•â•â•
// En production : fetch('/api/predict', { leviers }) â†’ RF.predict()
window.currentIFT = 2.80;
function recalc() {
  const rot    = +document.getElementById('f-rot').value;
  const solIdx = chipIdx('c-sol');   // 0=Labour, 1=TCS, 2=SD
  const desh   = +document.getElementById('f-desh').value;
  const deshI  = chipIdx('c-desh'); // 0=Non, 1=Partiel, 2=Complet
  const iftc   = +document.getElementById('f-iftc').value;
  const iftb   = +document.getElementById('f-iftb').value;
  const varr   = +document.getElementById('f-var').value;  // 0=rÃ©sistant, 2=standard
  const bioIdx = chipIdx('c-bio');   // 0=aucun, 1=partiel, 2=syst.
  const n      = +document.getElementById('f-n').value;
  const mb     = +document.getElementById('f-mb').value;
  const tps    = +document.getElementById('f-tps').value;
  const carb   = +document.getElementById('f-carb').value;
  const couvIdx= chipIdx('c-couv'); // 0=Absent, 1=Partiel, 2=SystÃ©matique

  // â”€â”€ Proxy RF â”€â”€
  let ift = 0.85;
  ift += Math.max(0, (3 - rot) * 0.075);
  ift += [0.22, 0.10, 0][solIdx] ?? 0.22;
  ift -= Math.min(desh, 4) * 0.07;
  ift -= [0, 0.15, 0.30][deshI] ?? 0;
  ift += iftc;
  ift += iftb;
  ift += varr * 0.10;
  ift -= [0, 0.12, 0.26][bioIdx] ?? 0;
  ift += Math.max(0, (n - 142) * 0.0035);
  ift = Math.max(0.15, Math.round(ift * 100) / 100);
  window.currentIFT = ift;

  // â”€â”€ Mise Ã  jour affichage ITK â”€â”€
  const clr = ift <= 1.61 ? 'var(--green-d)' : ift <= 2.30 ? 'var(--teal)' : 'var(--orange)';
  const pct = Math.min((ift / 4) * 100, 100);
  document.getElementById('itk-val').innerHTML = ift.toFixed(2) + '<span class="ift-card-unit">IFT</span>';
  document.getElementById('itk-val').style.color = clr;
  document.getElementById('itk-gauge').style.width = pct + '%';
  document.getElementById('itk-gauge').style.background = clr;
  document.getElementById('itk-chim').textContent = iftc.toFixed(2);
  document.getElementById('itk-bio').textContent  = iftb.toFixed(2);
  document.getElementById('itk-tps').textContent  = tps + ' h/ha';
  document.getElementById('itk-mb').textContent   = (+mb).toLocaleString('fr') + ' â‚¬/ha';
  document.getElementById('itk-carb').textContent = carb + ' L/ha';

  const vmed = ((ift - 2.30) / 2.30 * 100).toFixed(1);
  const vref = ((ift - 1.61) / 1.61 * 100).toFixed(1);
  const vmEl = document.getElementById('itk-vmed');
  vmEl.textContent = (vmed > 0 ? '+' : '') + vmed + '%';
  vmEl.style.color = vmed > 0 ? 'var(--orange)' : 'var(--green-d)';
  const vrEl = document.getElementById('itk-vref');
  vrEl.textContent = (vref > 0 ? '+' : '') + vref + '%';
  vrEl.style.color = vref > 0 ? 'var(--red)' : 'var(--green-d)';

  document.getElementById('sb-ift-tag').textContent = 'IFT actuel : ' + ift.toFixed(2);
  document.getElementById('sb-ift-tag').className = 'sb-bloc-tag ' + (ift <= 1.61 ? 'ok' : 'warn');

  // â”€â”€ Snapshot Ã©tat ITK â†’ alimenter la simulation â”€â”€
  const SOL_LABELS  = ['Labour', 'TCS', 'Semis direct'];
  const DESH_LABELS = ['Non', 'Oui â€” partiel', 'Oui â€” complet'];
  const BIO_LABELS  = ['Aucun', 'Partiel', 'SystÃ©matique'];
  const COUV_LABELS = ['Absent', 'Partiel', 'SystÃ©matique'];
  const VAR_LABELS  = { '0': 'TrÃ¨s rÃ©sistante', '1': 'RÃ©sistance partielle', '2': 'Standard' };
  window.itkState = {
    rot: rot,
    solLabel:  SOL_LABELS[solIdx]  ?? 'Labour',
    deshLabel: DESH_LABELS[deshI]  ?? 'Non',
    varLabel:  VAR_LABELS[String(varr)] ?? 'Standard',
    bioLabel:  BIO_LABELS[bioIdx]  ?? 'Aucun',
    couvLabel: COUV_LABELS[couvIdx] ?? 'Partiel',
    nVal: n,
    mb: mb, tps: tps, carb: carb
  };

  // â”€â”€ Propagation vers page simulation â”€â”€
  // 1. Mettre Ã  jour les labels "actuel" dans les cartes levier
  syncSimLabels();
  // 2. RÃ©initialiser les choix de simulation qui ne sont plus cohÃ©rents
  //    (on garde les deltas, seuls les labels changent â€” pas de reset forcÃ©
  //     pour ne pas perdre le travail de l'utilisateur en cours de simulation)

  // â”€â”€ Sync barre rÃ©sumÃ© sim â”€â”€
  document.getElementById('ss-curr').textContent = ift.toFixed(2);
  document.getElementById('mi-ift-c').textContent = ift.toFixed(2);

  // Mettre Ã  jour les valeurs "actuelles" dans la section multi-indicateurs sim
  const tpsEl = document.querySelector('#page-sim .mi-row:nth-child(3) .mi-curr');
  const mbEl  = document.querySelector('#page-sim .mi-row:nth-child(4) .mi-curr');
  const carbEl= document.querySelector('#page-sim .mi-row:nth-child(5) .mi-curr');
  if (tpsEl) tpsEl.textContent = tps + ' h/ha';
  if (mbEl)  mbEl.textContent  = (+mb).toLocaleString('fr') + ' â‚¬/ha';
  if (carbEl)carbEl.textContent= carb + ' L/ha';

  updateSim();
}

// â•â•â• SIMULATION â•â•â•
window.deltas = {};
const LEVS = ['rot','sol','desh','var','bio','couv','n'];

function simPick(el, lev, delta) {
  el.closest('.lev-opts').querySelectorAll('.lo').forEach(o => o.classList.remove('pick'));
  el.classList.add('pick');
  window.deltas[lev] = delta;
  const li = document.getElementById('li-' + lev);
  li.textContent = delta !== 0 ? delta.toFixed(2) + ' IFT' : 'â€”';
  li.className   = 'lev-impact-val ' + (delta !== 0 ? 'good' : 'neu');
  document.getElementById('lc-' + lev).classList.toggle('picked', delta !== 0);
  updateSim();
}

// â•â•â• RESET SIMULATION â•â•â•
// Remet toutes les cartes leviers sur "actuel" et vide les deltas
function resetSim() {
  window.deltas = {};
  LEVS.forEach(l => {
    const card = document.getElementById('lc-' + l);
    if (!card) return;
    // Remettre tous les boutons sur Ã©tat neutre, rÃ©-activer le bouton "curr"
    card.querySelectorAll('.lo').forEach(o => o.classList.remove('pick'));
    const currBtn = card.querySelector('.lo.curr');
    if (currBtn) currBtn.classList.remove('pick'); // curr garde son style .curr, pas .pick
    card.classList.remove('picked');
    // Remettre l'impact Ã  â€”
    const li = document.getElementById('li-' + l);
    if (li) { li.textContent = 'â€”'; li.className = 'lev-impact-val neu'; }
  });
  updateSim();
}

function updateSim() {
  const base = window.currentIFT || 2.80;
  const s    = window.itkState;
  let total = base, cnt = 0;

  LEVS.forEach(l => {
    const d = window.deltas[l] || 0;
    if (d !== 0) cnt++;
    total += d;
    const row = document.getElementById('wf-' + l);
    if (!row) return;
    if (d !== 0) {
      row.style.display = 'flex';
      document.getElementById('wfb-' + l).style.width = Math.min(Math.abs(d) / 4 * 100 * 1.2, 60) + '%';
      document.getElementById('wfv-' + l).textContent = d.toFixed(2);
    } else {
      row.style.display = 'none';
    }
  });

  total = Math.max(0.05, Math.round(total * 100) / 100);
  const gained  = base - total;
  const gainPct = (gained / base * 100).toFixed(1);
  const pct = Math.min((total / 4) * 100, 100);
  const clr = total <= 1.61 ? 'var(--green-d)' : total <= 2.30 ? 'var(--teal)' : 'var(--orange)';

  // Summary bar
  document.getElementById('ss-sim').textContent  = total.toFixed(2);
  document.getElementById('ss-sim').style.color   = clr;
  document.getElementById('ss-gain').textContent  = gained > 0 ? 'âˆ’' + gainPct + '%' : 'â€”';
  document.getElementById('ss-gain').style.color  = gained > 0 ? 'var(--green-d)' : 'var(--text3)';
  document.getElementById('ss-cnt').textContent   = cnt;

  // Waterfall final
  document.getElementById('wfb-fin').style.width     = pct + '%';
  document.getElementById('wfb-fin').style.background = clr;
  document.getElementById('wfv-fin').textContent      = total.toFixed(2);
  document.getElementById('wfv-fin').style.color      = clr;

  // Total impact box
  document.getElementById('sim-cnt-lbl').textContent = cnt + ' levier' + (cnt > 1 ? 's' : '') + ' activÃ©' + (cnt > 1 ? 's' : '');
  document.getElementById('sim-total').innerHTML = (gained > 0 ? 'âˆ’' + gainPct + '%' : 'â€”') + '<small> IFT</small>';

  // Positionnement
  const vmed = ((total - 2.30) / 2.30 * 100).toFixed(1);
  const vref = ((total - 1.61) / 1.61 * 100).toFixed(1);
  document.getElementById('sr-sim').textContent  = total.toFixed(2);
  document.getElementById('sr-sim').style.color   = clr;
  const smEl = document.getElementById('sr-med');
  smEl.textContent = (vmed > 0 ? '+' : '') + vmed + '%';
  smEl.style.color = vmed <= 0 ? 'var(--green-d)' : 'var(--orange)';
  const srEl = document.getElementById('sr-ref');
  srEl.textContent = (vref > 0 ? '+' : '') + vref + '%';
  srEl.style.color = vref <= 0 ? 'var(--green-d)' : 'var(--red)';
  const saEl = document.getElementById('sr-act');
  saEl.textContent = gained > 0 ? 'âˆ’' + gainPct + '%' : 'â€”';
  saEl.className   = 'v ' + (gained > 0 ? 'v-good' : 'v-neu');

  // Multi-indicateurs (valeurs simulÃ©es)
  document.getElementById('mi-ift-n').textContent = 'â†’ ' + total.toFixed(2);
  document.getElementById('mi-ift-n').style.color  = clr;

  const carbBase = s ? s.carb : 94;
  const carbSav  = Math.round(Math.abs(window.deltas['sol'] || 0) * 16 + Math.abs(window.deltas['n'] || 0) * 4);
  document.getElementById('mi-carb-n').textContent = 'â†’ ' + Math.max(0, carbBase - carbSav) + ' L/ha';
  document.getElementById('mi-carb-n').style.color  = carbSav > 0 ? 'var(--green-d)' : 'var(--text2)';

  const mbBase = s ? s.mb : 1292;
  const mbNew  = Math.round(mbBase + gained * 14);
  document.getElementById('mi-mb-n').textContent = 'â†’ ' + mbNew.toLocaleString('fr') + ' â‚¬/ha';
  document.getElementById('mi-mb-n').style.color  = gained > 0 ? 'var(--green-d)' : 'var(--text2)';

  const tpsBase  = s ? s.tps : 19.9;
  const tpsDelta = Math.abs(window.deltas['desh'] || 0) * 2.5;
  document.getElementById('mi-tps-n').textContent = 'â†’ ' + (tpsBase + tpsDelta).toFixed(1) + ' h/ha';
  document.getElementById('mi-tps-n').style.color  = tpsDelta > 0 ? 'var(--orange)' : 'var(--text2)';

  // ScÃ©nario tag
  const tag = document.getElementById('sim-tag');
  if (gained <= 0)        { tag.textContent = 'ScÃ©nario en cours';        tag.className = 'tag tag-orange'; }
  else if (total <= 1.61) { tag.textContent = 'â˜… Niveau rÃ©fÃ©rence !';     tag.className = 'tag tag-green';  }
  else if (total <= 2.30) { tag.textContent = 'âœ“ Sous la mÃ©diane';        tag.className = 'tag tag-teal';   }
  else                    { tag.textContent = 'En cours (âˆ’' + gainPct + '%)'; tag.className = 'tag tag-orange'; }
}

function resetForm() {
  document.getElementById('f-rot').value   = '3';   document.getElementById('sv-rot').textContent  = '3';
  document.getElementById('f-desh').value  = '0';   document.getElementById('sv-desh').textContent = '0';
  document.getElementById('f-iftc').value  = '2.40';
  document.getElementById('f-iftb').value  = '0.05';
  document.getElementById('f-var').value   = '2';
  document.getElementById('f-n').value     = '185'; document.getElementById('sv-n').textContent = '185';
  document.getElementById('f-p').value     = '60';  document.getElementById('sv-p').textContent = '60';
  document.getElementById('f-k').value     = '70';  document.getElementById('sv-k').textContent = '70';
  document.getElementById('f-mb').value    = '1292';
  document.getElementById('f-tps').value   = '19.9';
  document.getElementById('f-uth').value   = '2.0';
  document.getElementById('f-carb').value  = '94';
  document.getElementById('f-eau').value   = '0';
  [['c-couv',1],['c-sol',0],['c-desh',0],['c-bio',0]].forEach(([gid,idx]) => {
    document.querySelectorAll('#' + gid + ' .chip').forEach((c,i) => c.classList.toggle('on', i === idx));
  });
  recalc();
}

// Init
recalc();
</script>
</body>
</html>
